From 66e9d9fb911b3d75c42a9f44f059b867fc3005a9 Mon Sep 17 00:00:00 2001
From: hopeless-ponderer <hopelessponderer1123@gmail.com>
Date: Sat, 5 Jun 2021 16:59:34 -0700
Subject: [PATCH] Replace component adds old unit orders to new unit entity

---
 binaries/data/mods/public/simulation/components/Replace.js | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/binaries/data/mods/public/simulation/components/Replace.js b/binaries/data/mods/public/simulation/components/Replace.js
index 4d89e20581..50b2010a3f 100644
--- a/binaries/data/mods/public/simulation/components/Replace.js
+++ b/binaries/data/mods/public/simulation/components/Replace.js
@@ -35,7 +35,11 @@ Replace.prototype.Replace = function()
 	if (templates.length === 0)
 		return this.entity;
 	let template = pickRandom(templates);
-	return ChangeEntityTemplate(this.entity, template);
+	const newEntity = ChangeEntityTemplate(this.entity, template);
+	const cmpOldUnitAI = Engine.QueryInterface(this.entity, IID_UnitAI);
+	const cmpNewUnitAI = Engine.QueryInterface(newEntity, IID_UnitAI);
+	cmpNewUnitAI.AddOrders(cmpOldUnitAI.GetOrderData());
+	return newEntity;
 };// end Replace.prototype.Replace
 
 // no dynamic state to init or save
-- 
2.25.1

